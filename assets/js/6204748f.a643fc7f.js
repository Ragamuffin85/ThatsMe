"use strict";(self.webpackChunkthats_me=self.webpackChunkthats_me||[]).push([[2892],{3713:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"HowTo/Proxmox/PciPassthrough","title":"Enable PCI Passthrough in Proxmox VE","description":"Requirements","source":"@site/docs/HowTo/Proxmox/PciPassthrough.mdx","sourceDirName":"HowTo/Proxmox","slug":"/HowTo/Proxmox/PciPassthrough","permalink":"/ThatsMe/docs/HowTo/Proxmox/PciPassthrough","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"How To","permalink":"/ThatsMe/docs/HowTo/"},"next":{"title":"Reference","permalink":"/ThatsMe/docs/category/reference"}}');var r=t(4848),s=t(8453);const i={sidebar_position:6},a="Enable PCI Passthrough in Proxmox VE",d={},l=[{value:"Requirements",id:"requirements",level:2},{value:"Configure Proxmox",id:"configure-proxmox",level:2},{value:"GRUB config",id:"grub-config",level:3},{value:"Kernel modules",id:"kernel-modules",level:3},{value:"Apply configs",id:"apply-configs",level:2},{value:"Sources",id:"sources",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"enable-pci-passthrough-in-proxmox-ve",children:"Enable PCI Passthrough in Proxmox VE"})}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hardware needs to support IOMMU (Input/Output Memory Management Unit) - Normally all newer systems support this kind of feature"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configure-proxmox",children:"Configure Proxmox"}),"\n",(0,r.jsx)(n.p,{children:"To enable the passthrough support mainly two components needs to be adapted"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The bootloader(GRUB) config"}),"\n",(0,r.jsx)(n.li,{children:"The kernel modules"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"grub-config",children:"GRUB config"}),"\n",(0,r.jsxs)(n.p,{children:["Depending on your system you need to add the following parameters to your ",(0,r.jsx)(n.code,{children:"GRUB_CMDLINE_LINUX_DEFAULT"})," property"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Function"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"intel_iommu=on"}),(0,r.jsx)(n.td,{children:"Activates IOMMU for Intel systems"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"amd_iommu=on"}),(0,r.jsx)(n.td,{children:"Activates IOMMU for AMD systems"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"iommu=pt"}),(0,r.jsx)(n.td,{children:"pt stands for passthrough and increases the performance"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"For Intel based systems"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/default/grub"',children:'GRUB_CMDLINE_LINUX_DEFAULT="quiet intel_iommu=on iommu=pt"\n'})}),"\n",(0,r.jsx)(n.p,{children:"For AMD based systems"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/default/grub"',children:'GRUB_CMDLINE_LINUX_DEFAULT="quiet amd_iommu=on iommu=pt"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"kernel-modules",children:"Kernel modules"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Module"}),(0,r.jsx)(n.th,{children:"Function"}),(0,r.jsx)(n.th,{children:"Source"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"vfio"}),(0,r.jsx)(n.td,{children:"Virtual Function I/O"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"vfio_iommu_type1"}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-2",id:"user-content-fnref-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"vfio_pci"}),(0,r.jsx)(n.td,{children:"For devices that are not managed by libvirt"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-3",id:"user-content-fnref-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"vfio_virqfd"}),(0,r.jsx)(n.td,{children:"Not needed with PVE 8+ (Kernel 6.2) - It's no longer a seperate module"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-4",id:"user-content-fnref-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/modules',children:'# /etc/modules: kernel modules to load at boot time.\n#\n# This file contains the names of kernel modules that should be loaded\n# at boot time, one per line. Lines beginning with "#" are ignored.\nvfio\nvfio_iommu_type1\nvfio_pci\n#vfio_virqfd\n'})}),"\n",(0,r.jsx)(n.h2,{id:"apply-configs",children:"Apply configs"}),"\n",(0,r.jsx)(n.p,{children:"After restarting your system the configured settings should be applied automatically, and you're ready to go and pass-through your PCI devices."}),"\n",(0,r.jsx)(n.p,{children:"To check if everything works as expected you can ask your system for details"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dmesg | grep -e DMAR -e IOMMU\n\n...\n[    0.052157] DMAR: IOMMU enabled\n...\n[    0.389246] DMAR: Intel(R) Virtualization Technology for Directed I/O\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"lsmod | grep vfio\n\nvfio_pci               16384  1\nvfio_pci_core          86016  1 vfio_pci\nvfio_iommu_type1       49152  1\nvfio                   65536  8 vfio_pci_core,vfio_iommu_type1,vfio_pci\niommufd                94208  1 vfio\nirqbypass              12288  3 vfio_pci_core,kvm\n"})}),"\n",(0,r.jsx)(n.h2,{id:"sources",children:"Sources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.thomas-krenn.com/de/wiki/Proxmox_PCIe_Passthrough_aktivieren",children:"https://www.thomas-krenn.com/de/wiki/Proxmox_PCIe_Passthrough_aktivieren"})," ",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.a,{href:"https://enterprise-support.nvidia.com/s/article/understanding-the-iommu-linux-grub-file-configuration",children:"https://enterprise-support.nvidia.com/s/article/understanding-the-iommu-linux-grub-file-configuration"})," ",(0,r.jsx)("br",{})]}),"\n","\n",(0,r.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,r.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.kernel.org/doc/html/latest/driver-api/vfio.html",children:"https://www.kernel.org/doc/html/latest/driver-api/vfio.html"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-2",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.kernel.org/doc/html/latest/driver-api/vfio.html#iommufd-and-vfio-iommu-type1",children:"https://www.kernel.org/doc/html/latest/driver-api/vfio.html#iommufd-and-vfio-iommu-type1"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-2","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-3",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.ibm.com/docs/en/linux-on-systems?topic=setup-pci",children:"https://www.ibm.com/docs/en/linux-on-systems?topic=setup-pci"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-3","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{id:"user-content-fn-4",children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://forum.proxmox.com/threads/pci-gpu-passthrough-on-proxmox-ve-8-installation-and-configuration.130218/",children:"https://forum.proxmox.com/threads/pci-gpu-passthrough-on-proxmox-ve-8-installation-and-configuration.130218/"})," ",(0,r.jsx)(n.a,{href:"#user-content-fnref-4","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(6540);const r={},s=o.createContext(r);function i(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);